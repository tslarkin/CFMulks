{# Shows records in five record blocks. Uses bottom of page navigation. #}
{% extends "Notebooks/base.html" %}
{% load static %}
{% block head %}
{{ block.super }}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
{% endblock head %}

{% load notebook_extras %}

{% block content %}


{% for page in  block_obj %}
{% include "partials/showpage.html" %}
{% endfor %}
{% endblock content %}

{% block footer %}
<!-- https://realpython.com/django-pagination/ -->
<footer>
    <div style="margin: 5px 0 15px 0">
    {% if block_obj.has_previous %}
        <a href="?block=1">
            ⏮️
        </a>
        <a href="?block={{block_obj.previous_page_number}}">
            ◀️
        </a>
    {% endif%}

    <span id="jump">
        <form method="POST" action="" style="display:inline;">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="jump">
            <input  style="font-size:16px; width: 40px; text-align:right;" 
                name="block_num" min=1 max={{block_obj.paginator.num_pages}} type="number" value={{ block_obj.number}}>
        </form>    
    </span> <span style="font-size:16px">of {{block_obj.paginator.num_pages}}</span>

    {% if block_obj.has_next %}
        <a href="?block={{block_obj.next_page_number}}">
            ▶️
        </a>
        <a href="?block={{block_obj.paginator.num_pages}}">
            ⏭️
        </a>
    {% endif%}
    </div>
    <div id="ellipsis" style="margin-top: 5px">
    {% for block_number in block_range %}
        {% if block_number == block_obj.paginator.ELLIPSIS %}
            {{block_number}}
        {% else %}
             <a
                href="?block={{block_number}}"
                class="{% if block_number == block_obj.number %} current {% endif %}"
            >
                {{block_number}}
            </a>
        {% endif %}
    {% endfor %}
    </div>
</footer>
<script>
    $(function() {
        $("#tags").autocomplete({ // Replace 'id_tags' with your actual input field ID
            source: "{% url 'tag_autocomplete' %}",
            minLength: 2, // Minimum characters before autocomplete starts
            select: function(event, ui) {
                var currentTags = $(this).val().split(',').map(s => s.trim()).filter(s => s);
                var selectedTag = ui.item.value;

                if (!currentTags.includes(selectedTag)) {
                    currentTags.push(selectedTag);
                }
                $(this).val(currentTags.join(', '));
                return true; // Prevent default action (replacing input with selected value)
            },
            change: function(event, ui) {
                // If the user types a new tag and blurs the input, add it
                if (!ui.item) {
                    var newTag = $(this).val().trim();
                    if (newTag) {
                        var currentTags = $(this).val().split(',').map(s => s.trim()).filter(s => s);
                        if (!currentTags.includes(newTag)) {
                            currentTags.push(newTag);
                        }
                        $(this).val(currentTags.join(', '));
                    }
                }
            }
        });
    });

</script>
{% endblock footer%}
