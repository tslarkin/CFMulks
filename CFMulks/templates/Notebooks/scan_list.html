{% extends "Notebooks/base.html" %}
{% load static %}
{% load notebook_extras %}

{% block nav %}
{{ block.super }}
<a style="order: 0" href="/">Home</a>
{% endblock nav %}
{% block content %}

<div style="box-sizing: border-box; padding-right: 20px; display:flex; flex-wrap: row nowrap; width:100%; justify-content: space-between">
    <h1>The Notebooks of Charles Mulks</h1> 󠄚<div>[{{ page_obj.number }}]</div></div>

{% for scan in  page_obj %}
<div><h2>{{scan.notebook.roman_numeral}}.{{scan.name}}</h2>

<div id="{{scan.name}}" style="display:flex; flex-direction:row; column-gap: 40px" >
{% if user.is_authenticated %}
<form class="scanform" method="POST">
    {% csrf_token %}
    <input name="page_num" type="hidden" value={{ page_obj.number}}>
    <input type="hidden" name="id" value={{scan.id}}>
    <input type="hidden" name="form_type" value="scan_update">
    <label for="seq_num">Sequence</label>
    <input onchange="inputChanged(this)" id="seq_num" type="number" name="seq_num" value="{{scan.seq_num}}" style="width: 60px"
    {% if not user.is_authenticated %}readonly{% endif %}>
    <label for="transcription">Transcription</label>
    <textarea onchange="inputChanged(this)" id="transcription" name="transcription" rows="20"  style="width: 100%" {% if not user.is_authenticated %}readonly{% endif %}>{{scan.transcription}}</textarea>
    <label for="description">Comment</label>
    <textarea onchange="inputChanged(this)" id="description" name="description" rows="6" style="width: 100%" {% if not user.is_authenticated %}readonly{% endif %}>{{scan.description}}</textarea>
    {% if user.is_authenticated %}<input onchange("scanSubmitted(this)") id="submitscan" type="submit" value="Submit">{% endif %}
</form>
{% else %}
<div class="read-only">
    {% if scan.seq_num %}
    <div style="margin-bottom: 3px; text-align: center">
        {{ scan.seq_num }}
    </div>
    {% endif %}
    {% if scan.transcription %}
    {{scan.transcription |render_markdown }}
    {% endif %}
    {% if scan.description %}
    <div style="display: flex; justify-items: flex-start; flex-direction: column; flex-wrap: column nowrap; font-style: italic; margin-top: 1em"">
        {{ scan.description | render_markdown}}
    </div>
    {% endif %}
</div>
{% endif %}
<figure>
    <img src="{% static 'img' %}/{{scan.notebook.name}}/{{scan.file}}"/>
</figure>
</div>
{% endfor %}
{% endblock content %}

{% block footer %}
<!-- https://realpython.com/django-pagination/ -->
<footer>
    <div style="margin: 5px 0 15px 0">
    {% if page_obj.has_previous %}
        <a href="?page=1">
            ⏮️
        </a>
        <a href="?page={{page_obj.previous_page_number}}">
            ◀️
        </a>
    {% endif%}

    <span id="jump">
        <form method="POST" action="" style="display:inline;">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="jump">
            <input  style="font-size:16px; width: 40px; text-align:right;" 
                name="page_num" min=1 max={{page_obj.paginator.num_pages}} type="number" value={{ page_obj.number}}>
        </form>    
    </span> <span style="font-size:16px">of {{page_obj.paginator.num_pages}}</span>

    {% if page_obj.has_next %}
        <a href="?page={{page_obj.next_page_number}}">
            ▶️
        </a>
        <a href="?page={{page_obj.paginator.num_pages}}">
            ⏭️
        </a>
    {% endif%}
    </div>
    <div id="ellipsis" style="margin-top: 5px">
    {% for page_number in paginator_range %}
        {% if page_number == page_obj.paginator.ELLIPSIS %}
            {{page_number}}
        {% else %}
             <a
                href="?page={{page_number}}"
                class="{% if page_number == page_obj.number %} current {% endif %}"
            >
                {{page_number}}
            </a>
        {% endif %}
    {% endfor %}
    </div>
</footer>
{% endblock %}
